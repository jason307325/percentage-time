<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>COACH TECH 2026 - 深色模式動畫版</title>
<style>
:root {
    --bg-dark: #0d1117;
    --panel-dark: #161b22;
    --panel-light: #0a0d12;
    --text-light: #fff;
    --neon-blue: #00a2ff;
    --neon-green: #4cd964;
    --neon-red: #ff3b30;
}
* { box-sizing:border-box; margin:0; padding:0; -webkit-tap-highlight-color:transparent; }
html,body { width:100%; height:100vh; font-family:-apple-system,system-ui,sans-serif; background:var(--bg-dark); color:var(--text-light); overflow:hidden; display:flex; flex-direction:column; touch-action: manipulation; -ms-touch-action: manipulation;}
.container { flex:1; display:flex; flex-direction:column; max-width:480px; margin:auto; padding:8px; }
h1 { text-align:center; font-size:14px; color:#888; margin-bottom:8px; }

.mode-switch { display:flex; gap:5px; margin-bottom:8px; }
.mode-switch button { flex:1; padding:10px 0; border:none; border-radius:8px; font-weight:700; cursor:pointer; background:#222; color:#888; transition:0.2s; }
.mode-switch button.active { color:#fff; background:var(--neon-blue); box-shadow:0 3px 8px rgba(0,162,255,0.3);}
.mode-switch button.multi-btn.active { background:var(--neon-green); box-shadow:0 3px 8px rgba(76,217,100,0.3); }

.time-display { display:flex; justify-content:center; align-items:center; gap:5px; margin-bottom:8px; }
.unit-box { flex:1; text-align:center; border:1.5px solid #333; border-radius:8px; padding:6px 0; font-size:20px; font-weight:700; background:var(--panel-light); cursor:pointer; user-select:none; }
.unit-box.active { border-color:var(--neon-blue); background:var(--panel-dark); }
.unit-box span { font-size:10px; color:#888; display:block; margin-top:0; }

.sep { font-size:20px; font-weight:bold; color:#555; }

.view-area { flex:1; display:flex; flex-direction:column; overflow:hidden; }
#athleteView,#coachView,#multiView { display:none; flex-direction:column; flex:1; overflow:hidden; }

.range-wrapper { position:relative; width:100%; height:40px; margin:5px 0; }
input[type=range] { width:100%; -webkit-appearance:none; background:#333; height:6px; border-radius:3px; outline:none; }
input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; width:28px; height:28px; border-radius:50%; background:var(--neon-blue); cursor:pointer; border:2px solid #fff; margin-top:-11px; transition: background 0.2s; }
input[type=range].multi::-webkit-slider-thumb { background:var(--neon-green); }

.bubble { position:absolute; top:-30px; font-weight:700; font-size:14px; padding:2px 6px; border-radius:6px; background:var(--neon-blue); color:#fff; transform:translateX(-50%); pointer-events:none; transition:left 0.15s ease; }

.result { text-align:center; font-size:40px; font-weight:900; margin-top:10px; color:var(--neon-blue); }

#coachView table { width:100%; border-collapse:collapse; overflow-y:auto; flex:1; }
#coachView td { padding:8px 5px; text-align:center; font-family:monospace; font-weight:700; color:var(--neon-blue); border-bottom:1px solid #222; }
#coachView tr.active-row td { background:rgba(0,162,255,0.2); }

.multi-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; }
.btn-group { display:flex; gap:4px; }
.add-btn, .clear-btn { padding:4px 8px; border:none; border-radius:6px; cursor:pointer; font-size:12px; font-weight:700; }
.add-btn { background:var(--neon-green); color:#fff; }
.clear-btn { background:#555; color:#fff; }

#multiCardsArea { flex:1; overflow-y:auto; }
.multi-card { background:var(--panel-light); border-left:4px solid var(--neon-green); margin-bottom:4px; padding:6px 10px; border-radius:6px; display:flex; align-items:center; justify-content:space-between; cursor:pointer; transition: background 0.15s; }
.multi-card.selected { background:#111; border-color:var(--neon-green); }
.multi-res { font-family:monospace; font-weight:700; color:var(--neon-green); font-size:20px; }

.del-btn { width:22px; height:22px; border-radius:50%; background:#222; color:var(--neon-red); display:flex; align-items:center; justify-content:center; font-weight:700; cursor:pointer; }

.numpad-wrapper { display:grid; grid-template-columns:repeat(3,1fr); gap:5px; margin-top:5px; }
.key { background:#222; color:#fff; height:48px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:700; cursor:pointer; }
.key.gray { background:#555; }
</style>
</head>
<body>
<div class="container">
<h1>COACH TECH 2026</h1>
<div class="mode-switch">
    <button id="athleteBtn" class="active">選手版</button>
    <button id="coachBtn">教練版</button>
    <button id="multiBtn" class="multi-btn">多人模式</button>
</div>
<div class="time-display">
    <div id="box-0" class="unit-box active" onclick="focusBox(0)">00<span>分</span></div>
    <div class="sep">:</div>
    <div id="box-1" class="unit-box" onclick="focusBox(1)">00<span>秒</span></div>
    <div class="sep">.</div>
    <div id="box-2" class="unit-box" onclick="focusBox(2)">00<span>毫秒</span></div>
</div>
<div class="view-area">
    <div id="athleteView" style="display:flex">
        <div class="range-wrapper">
            <div class="bubble" id="athleteBubble">100%</div>
            <input type="range" id="mainRange" min="50" max="110" value="100">
        </div>
        <div class="result" id="resText">00:00.00</div>
    </div>
    <div id="coachView">
        <table><tbody id="coachTable"></tbody></table>
    </div>
    <div id="multiView">
        <div class="multi-header">
            <span style="color:#888;font-size:12px;">選手清單</span>
            <div class="btn-group">
                <button class="clear-btn" onclick="clearAllMulti()">清空時間</button>
                <button class="add-btn" onclick="addAthlete()">+ 新增</button>
            </div>
        </div>
        <div class="range-wrapper">
            <div class="bubble" id="multiBubble">100%</div>
            <input type="range" id="mRange" min="50" max="110" value="100" class="multi">
        </div>
        <div id="multiCardsArea"></div>
    </div>
</div>
<div class="numpad-wrapper">
    <div class="key" onclick="press(7)">7</div>
    <div class="key" onclick="press(8)">8</div>
    <div class="key" onclick="press(9)">9</div>
    <div class="key" onclick="press(4)">4</div>
    <div class="key" onclick="press(5)">5</div>
    <div class="key" onclick="press(6)">6</div>
    <div class="key" onclick="press(1)">1</div>
    <div class="key" onclick="press(2)">2</div>
    <div class="key" onclick="press(3)">3</div>
    <div class="key gray" onclick="press('C')">AC</div>
    <div class="key" onclick="press(0)">0</div>
    <div class="key gray" onclick="press('X')">⌫</div>
</div>

<script>
let currentFocus=0,currentMode='athlete',multiTargetIdx=0;
let singleValues=["00","00","00"];
let multiAthletes=[{vals:["00","00","00"]},{vals:["00","00","00"]},{vals:["00","00","00"]},{vals:["00","00","00"]}];
let isNewInput=true;

const mainRange=document.getElementById('mainRange');
const athleteBubble=document.getElementById('athleteBubble');
const mRange=document.getElementById('mRange');
const multiBubble=document.getElementById('multiBubble');

function init(){
    document.getElementById('athleteBtn').onclick=()=>switchMode('athlete');
    document.getElementById('coachBtn').onclick=()=>switchMode('coach');
    document.getElementById('multiBtn').onclick=()=>switchMode('multi');

    mainRange.addEventListener('input',()=>{updateBubble(mainRange,athleteBubble); calculate(); renderCoachTable();});
    mRange.addEventListener('input',()=>{updateBubble(mRange,multiBubble); calculate(); renderMultiCards();});

    focusBox(0);
    switchMode('athlete');
    calculate();
}

function updateBubble(slider,bubble){
    const percent=(slider.value-slider.min)/(slider.max-slider.min);
    bubble.innerText=slider.value+'%';
    bubble.style.left=`${percent*100}%`;
}

function switchMode(m){
    currentMode=m;
    document.querySelectorAll('.mode-switch button').forEach(b=>b.classList.remove('active'));
    document.getElementById(m+'Btn').classList.add('active');
    document.getElementById('athleteView').style.display=m==='athlete'?'flex':'none';
    document.getElementById('coachView').style.display=m==='coach'?'flex':'none';
    document.getElementById('multiView').style.display=m==='multi'?'flex':'none';
    updateInputDisplay();
    calculate();
}

function focusBox(idx){currentFocus=idx;isNewInput=true;updateInputDisplay();}
function updateInputDisplay(){
    let active=(currentMode==='multi')?multiAthletes[multiTargetIdx].vals:singleValues;
    for(let i=0;i<3;i++){
        let box=document.getElementById('box-'+i);
        box.classList.toggle('active',i===currentFocus);
        box.innerHTML=active[i]+'<span>'+(i===0?'分':i===1?'秒':'毫秒')+'</span>';
    }
}

function press(key){
    let active=(currentMode==='multi')?multiAthletes[multiTargetIdx].vals:singleValues;
    if(key==='C'){active.fill('00');currentFocus=0;isNewInput=true;}
    else if(key==='X'){if(active[currentFocus]==='00' && currentFocus>0){currentFocus--;active[currentFocus]='00';}else active[currentFocus]='00';isNewInput=true;}
    else{if(isNewInput){active[currentFocus]='0'+key;isNewInput=false;}else{active[currentFocus]=(active[currentFocus].slice(-1)+key).slice(-2);if(currentFocus<2){currentFocus++;isNewInput=true;}}}
    if(currentMode!=='multi') renderCoachTable();
    updateInputDisplay(); calculate();
}

function toTotalMs(arr){return parseInt(arr[0])*60000 + parseInt(arr[1])*1000 + parseInt(arr[2])*10;}
function formatMs(ms){if(!ms||ms<=0) return "00:00.00";let m=Math.floor(ms/60000);ms%=60000;let s=Math.floor(ms/1000);ms%=1000;return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}.${Math.floor(ms/10).toString().padStart(2,'0')}`;}

function calculate(){
    let base=toTotalMs(singleValues);
    document.getElementById('resText').innerText=formatMs(base*(2-parseInt(mainRange.value)/100));
    updateBubble(mainRange,athleteBubble);
    renderCoachTable();

    updateBubble(mRange,multiBubble);
    renderMultiCards();
}

function renderCoachTable(){
    const base=toTotalMs(singleValues);
    let html='';
    for(let i=110;i>=50;i--){
        let rowMs=base*(2-i/100);
        html+=`<tr id="row-${i}"><td style="font-weight:700;width:50px">${i}%</td><td>${formatMs(rowMs)}</td></tr>`;
    }
    document.getElementById('coachTable').innerHTML=html;
    document.querySelectorAll('#coachTable tr').forEach(r=>r.style.background='');
    let row=document.getElementById('row-'+mainRange.value);
    if(row) row.style.background='rgba(0,162,255,0.2)';
}

function addAthlete(){multiAthletes.push({vals:["00","00","00"]}); setMultiTarget(multiAthletes.length-1); calculate();}
function deleteAthlete(idx){if(idx<4) return; multiAthletes.splice(idx,1); if(multiTargetIdx>=multiAthletes.length) multiTargetIdx=multiAthletes.length-1; setMultiTarget(multiTargetIdx);}
function clearAllMulti(){if(confirm("清空所有選手時間？")){multiAthletes.forEach(a=>a.vals=["00","00","00"]); updateInputDisplay(); renderMultiCards(); calculate();}}
function setMultiTarget(idx){multiTargetIdx=idx; updateInputDisplay(); renderMultiCards();}
function renderMultiCards(){
    let area=document.getElementById('multiCardsArea'); area.innerHTML='';
    multiAthletes.forEach((a,i)=>{
        let base=toTotalMs(a.vals);
        let target=base*(2-parseInt(mRange.value)/100);
        let card=document.createElement('div'); card.className='multi-card'+(i===multiTargetIdx?' selected':'');
        card.onclick=()=>setMultiTarget(i);
        let del=i>=4?`<div class="del-btn" onclick="event.stopPropagation();deleteAthlete(${i})">×</div>`:'';
        card.innerHTML=`<div>選手 ${i+1} ${i<4?'<small style="color:#888">(固定)</small>':''}<br><small style="color:#888">基準:${formatMs(base)}</small></div><div class="multi-res">${formatMs(target)}</div>${del}`;
        area.appendChild(card);
    });
}

init();
</script>
</body>
</html>
