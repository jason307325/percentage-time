<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>COACH TECH 2026 - Dark Mode</title>
<style>
:root {
    --bg-dark: #0d1117;
    --panel-dark: #161b22;
    --panel-light: #0a0d12;
    --text-light: #fff;
    --neon-blue: #00a2ff;
    --neon-green: #4cd964;
    --neon-red: #ff3b30;
    --accent: #4ae3ff;
    --gray-dark: #444;
    --gray-light: #888;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin:0; padding:0; }
html, body { height: 100%; width:100%; background: var(--bg-dark); color: var(--text-light); font-family: -apple-system, system-ui, sans-serif; overflow: hidden; }
body { display:flex; flex-direction:column; padding-top: env(safe-area-inset-top); }

.container { flex:1; padding:5px 10px; display:flex; flex-direction:column; max-width:420px; margin:auto; width:100%; overflow:hidden; }
h1 { text-align:center; font-size:13px; color:var(--gray-light); margin-bottom:5px; letter-spacing:1px; }

.mode-switch { display:flex; gap:5px; margin-bottom:8px; flex-shrink:0; }
.mode-switch button { flex:1; padding:10px 2px; border:none; border-radius:10px; font-weight:bold; font-size:13px; cursor:pointer; background: var(--panel-dark); color: var(--gray-light); transition:0.2s; }
.mode-switch button.active { background: var(--neon-blue); color:#fff; box-shadow:0 4px 10px rgba(0,162,255,0.3);}
.mode-switch button.active.multi-btn { background: var(--neon-green); box-shadow:0 4px 10px rgba(76,217,100,0.3);}

.time-display { display:flex; align-items:center; justify-content:center; gap:6px; background: var(--panel-dark); padding:8px; border-radius:14px; flex-shrink:0; }
.unit-box { flex:1; text-align:center; border:2.5px solid var(--gray-dark); border-radius:10px; padding:6px 0; font-size:24px; font-weight:800; color:var(--text-light); background: var(--panel-light); }
.unit-box.active { border-color: var(--neon-blue); background: #0a0d12; color: var(--neon-blue);}
.unit-box span { font-size:10px; display:block; color: var(--gray-light); margin-top:-2px; }
.sep { font-size:20px; font-weight:bold; color: var(--gray-light); }

.view-area { flex:1; overflow:hidden; display:flex; flex-direction:column; }

#athleteView, #coachView, #multiView { width:100%; height:100%; display:none; flex-direction:column; }

.range-wrapper { position:relative; width:100%; height:46px; background: var(--panel-light); border-radius:23px; display:flex; align-items:center; padding:0 4px; margin:5px 0; }
input[type=range] { width:100%; height:100%; -webkit-appearance:none; background:transparent; cursor:pointer; z-index:3; }
input[type=range]::-webkit-slider-thumb { -webkit-appearance:none; width:84px; height:38px; border-radius:19px; border:2.5px solid #0d1117; box-shadow:0 3px 6px rgba(0,0,0,0.3); background: var(--neon-blue);}
.multi-range::-webkit-slider-thumb { background: var(--neon-green); }

.bubble { position:absolute; pointer-events:none; top:50%; transform: translate(-50%,-50%); z-index:4; font-weight:900; font-size:18px; text-align:center; border-radius:10px; padding:2px 6px; color:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.5);}
#athleteBubble { background: var(--neon-blue);}
#multiBubble { background: var(--neon-green);}

#athleteView { justify-content:flex-start; gap:15px; padding:5px 0;}
.result { background: var(--panel-dark); padding:18px 10px; border-radius:20px; text-align:center; font-size:50px; font-weight:900; color: var(--neon-blue); box-shadow:0 4px 12px rgba(0,162,255,0.3); }

#coachView { overflow-y:auto; background: var(--panel-dark); border-radius:14px; border:1px solid var(--panel-light); }
table { width:100%; border-collapse:collapse; }
td { padding:12px 5px; text-align:center; border-bottom:1px solid var(--panel-light); color:var(--text-light); }
.td-res { font-size:28px; font-weight:900; font-family:monospace; color:var(--neon-blue); }

tr.active-row { background-color: #222 !important; }
tr.active-row td { color: #fff; border-top:2px solid var(--neon-blue); border-bottom:2px solid var(--neon-blue); }
tr.active-row .td-res { font-size:32px; }

.multi-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; flex-shrink:0; color:var(--text-light);}
.btn-group { display:flex; gap:6px; }
.add-btn { background: var(--neon-green); color:#fff; border:none; padding:6px 12px; border-radius:8px; font-size:12px; font-weight:bold; cursor:pointer; }
.clear-btn { background: var(--gray-dark); color:#fff; border:none; padding:6px 12px; border-radius:8px; font-size:12px; font-weight:bold; cursor:pointer; }

#multiCardsArea { flex:1; overflow-y:auto; padding-bottom:10px; -webkit-overflow-scrolling:touch; }
.multi-card { background: var(--panel-dark); border-radius:14px; padding:10px 15px; border-left:6px solid var(--neon-green); box-shadow:0 2px 5px rgba(0,0,0,0.2); display:flex; align-items:center; margin-bottom:8px; height:65px; position:relative; color: var(--text-light);}
.multi-card.selected { background: #111; border-color: var(--neon-green); outline: 2px solid var(--neon-green);}
.multi-res { font-size:30px; font-weight:900; color: var(--neon-green); font-family:monospace; letter-spacing:-1px; margin-left:auto; padding-right:30px; }
.del-btn { position:absolute; right:8px; top:50%; transform:translateY(-50%); width:24px; height:24px; background: #222; color: var(--neon-red); border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:16px; font-weight:bold; cursor:pointer; }

.numpad-wrapper { background: var(--panel-dark); padding:8px 8px calc(env(safe-area-inset-bottom)+5px) 8px; flex-shrink:0; }
.numpad { display:grid; grid-template-columns:repeat(3,1fr); gap:6px; max-width:400px; margin:0 auto; }
.key { background: var(--panel-light); height:48px; display:flex; justify-content:center; align-items:center; font-size:22px; font-weight:600; border-radius:10px; box-shadow:0 1px 2px rgba(0,0,0,0.3); cursor:pointer; user-select:none; color:var(--text-light);}
.key:active { background: #222; }
.key.gray { background: #444; color:#fff;}
</style>
</head>
<body>
<div class="container">
    <h1>COACH TECH 2026</h1>
    <div class="mode-switch">
        <button id="athleteBtn" class="active">選手版</button>
        <button id="coachBtn">教練版</button>
        <button id="multiBtn" class="multi-btn">多人模式</button>
    </div>
    <div class="time-display">
        <div id="box-0" class="unit-box active" onclick="focusBox(0)">00<span>分</span></div>
        <div class="sep">:</div>
        <div id="box-1" class="unit-box" onclick="focusBox(1)">00<span>秒</span></div>
        <div class="sep">.</div>
        <div id="box-2" class="unit-box" onclick="focusBox(2)">00<span>毫秒</span></div>
    </div>
    <div class="view-area">
        <div id="athleteView" style="display:flex">
            <div class="range-wrapper">
                <div class="bubble" id="athleteBubble">100%</div>
                <input type="range" id="mainRange" min="50" max="110" step="1" value="100">
            </div>
            <div id="resText" class="result">00:00.00</div>
        </div>
        <div id="coachView">
            <table><tbody id="coachTable"></tbody></table>
        </div>
        <div id="multiView">
            <div class="multi-header">
                <span style="font-size: 13px; font-weight:bold;">選手清單</span>
                <div class="btn-group">
                    <button class="clear-btn" onclick="clearAllMulti()">清空時間</button>
                    <button class="add-btn" onclick="addAthlete()">+ 新增</button>
                </div>
            </div>
            <div class="range-wrapper">
                <div class="bubble" id="multiBubble">100%</div>
                <input type="range" class="multi-range" id="mRange" min="50" max="110" step="1" value="100">
            </div>
            <div id="multiCardsArea">
                <div id="multiCardsList"></div>
            </div>
        </div>
    </div>
</div>
<div class="numpad-wrapper">
    <div class="numpad">
        <div class="key" onclick="press(7)">7</div><div class="key" onclick="press(8)">8</div><div class="key" onclick="press(9)">9</div>
        <div class="key" onclick="press(4)">4</div><div class="key" onclick="press(5)">5</div><div class="key" onclick="press(6)">6</div>
        <div class="key" onclick="press(1)">1</div><div class="key" onclick="press(2)">2</div><div class="key" onclick="press(3)">3</div>
        <div class="key gray" onclick="press('C')">AC</div><div class="key" onclick="press(0)">0</div><div class="key gray" onclick="press('X')">⌫</div>
    </div>
</div>

<script>
/* 核心邏輯保持不變，僅背景/樣式改色 */
let currentFocus = 0, currentMode = 'athlete', multiTargetIdx = 0;
let singleValues = ["00", "00", "00"];
let multiAthletes = [{vals:["00","00","00"]},{vals:["00","00","00"]},{vals:["00","00","00"]},{vals:["00","00","00"]}];
let isNewInput = true;
const STORAGE_KEY = 'coachTechData_v2026_sync_fix';

const mainRange = document.getElementById('mainRange'), athleteBubble = document.getElementById('athleteBubble'), mRange = document.getElementById('mRange'), multiBubble = document.getElementById('multiBubble');

function init() {
    loadData();
    document.getElementById('athleteBtn').onclick = () => switchMode('athlete');
    document.getElementById('coachBtn').onclick = () => switchMode('coach');
    document.getElementById('multiBtn').onclick = () => switchMode('multi');
    
    mainRange.oninput = () => { calculate(); syncCoachView(); };
    mRange.oninput = calculate;

    renderCoachTableBase();
    switchMode(currentMode);
    calculate();
}

function loadData() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
        const data = JSON.parse(saved);
        singleValues = data.single || singleValues;
        multiAthletes = data.multi || multiAthletes;
        mainRange.value = data.mainRange || 100;
        mRange.value = data.mRange || 100;
    }
}

function saveData() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
        single: singleValues, multi: multiAthletes, mainRange: mainRange.value, mRange: mRange.value
    }));
}

/* 以下核心邏輯保持原版，僅顏色/樣式改深色模式 */
function switchMode(m){currentMode=m;document.querySelectorAll('.mode-switch button').forEach(b=>b.classList.remove('active'));document.getElementById(m+'Btn').classList.add('active');document.getElementById('athleteView').style.display=m==='athlete'?'flex':'none';document.getElementById('coachView').style.display=m==='coach'?'block':'none';document.getElementById('multiView').style.display=m==='multi'?'flex':'none';if(m==='coach'){renderCoachTableBase();setTimeout(scrollToActiveRow,50);}else if(m==='multi'){setMultiTarget(multiTargetIdx);}else{focusBox(0);}calculate();}
function renderCoachTableBase(){const baseMs=toTotalMs(singleValues);let html="";for(let i=110;i>=50;i--){const rowMs=baseMs*(2-i/100);html+=`<tr id="row-${i}"><td style="font-weight:bold;width:60px">${i}%</td><td class="td-res">${formatMs(rowMs)}</td></tr>`;}document.getElementById('coachTable').innerHTML=html;syncCoachView();}
function syncCoachView(){const val=mainRange.value;document.querySelectorAll('#coachTable tr').forEach(r=>r.classList.remove('active-row'));const activeRow=document.getElementById(`row-${val}`);if(activeRow){activeRow.classList.add('active-row');if(currentMode==='coach')scrollToActiveRow();}}
function scrollToActiveRow(){const activeRow=document.querySelector('.active-row');if(activeRow)activeRow.scrollIntoView({behavior:'smooth',block:'center'});}
function addAthlete(){multiAthletes.push({vals:["00","00","00"]});setMultiTarget(multiAthletes.length-1);calculate();}
function deleteAthlete(e,idx){e.stopPropagation();if(idx<4)return;multiAthletes.splice(idx,1);if(multiTargetIdx>=multiAthletes.length)multiTargetIdx=multiAthletes.length-1;setMultiTarget(multiTargetIdx);calculate();}
function clearAllMulti(){if(confirm("清空所有選手基準時間？")){multiAthletes.forEach(ath=>ath.vals=["00","00","00"]);updateInputDisplay();calculate();}}
function setMultiTarget(idx){multiTargetIdx=idx;updateInputDisplay();renderMultiCards();}
function renderMultiCards(){const list=document.getElementById('multiCardsList');if(!list)return;list.innerHTML="";const mPct=parseInt(mRange.value);multiAthletes.forEach((ath,i)=>{const baseMs=toTotalMs(ath.vals);const targetMs=baseMs*(2-mPct/100);const card=document.createElement('div');card.className=`multi-card ${i===multiTargetIdx?'selected':''}`;card.onclick=()=>setMultiTarget(i);const deleteBtnHtml=i>=4?`<div class="del-btn" onclick="deleteAthlete(event, ${i})">×</div>`:"";card.innerHTML=`<div style="flex:1"><span style="font-weight:bold;font-size:14px">選手 ${i+1} ${i<4?'<small style="color:#888">(固定)</small>':''}</span><br><span style="font-size:11px;color:#888">基準: ${formatMs(baseMs)}</span></div><div class="multi-res">${formatMs(targetMs)}</div>${deleteBtnHtml}`;list.appendChild(card);});}
function focusBox(idx){currentFocus=idx;isNewInput=true;updateInputDisplay();}
function updateInputDisplay(){let activeData=(currentMode==='multi')?multiAthletes[multiTargetIdx].vals:singleValues;for(let i=0;i<3;i++){const box=document.getElementById('box-'+i);box.classList.toggle('active',i===currentFocus);box.innerHTML=activeData[i]+`<span>${['分','秒','毫秒'][i]}</span>`;}}
function press(key){if(navigator.vibrate) navigator.vibrate(5);let activeData=(currentMode==='multi')?multiAthletes[multiTargetIdx].vals:singleValues;if(key==='C'){activeData.fill("00");currentFocus=0;isNewInput=true;}else if(key==='X'){if(activeData[currentFocus]==="00"&&currentFocus>0){currentFocus--;activeData[currentFocus]="00";}else activeData[currentFocus]="00";isNewInput=true;}else{if(isNewInput){activeData[currentFocus]="0"+key;isNewInput=false;}else{activeData[currentFocus]=(activeData[currentFocus].slice(-1)+key).slice(-2);if(currentFocus<2){currentFocus++;isNewInput=true;}}}if(currentMode!=='multi') renderCoachTableBase();updateInputDisplay();calculate();}
function calculate(){const baseMs=toTotalMs(singleValues);const aPct=parseInt(mainRange.value);const aPos=(aPct-50)/60;athleteBubble.innerText=aPct+'%';athleteBubble.style.left=`calc(42px + ${aPos}*(100%-84px))`;athleteBubble.style.background=var(--neon-blue);athleteBubble.style.color="#fff";document.getElementById('resText').innerText=formatMs(baseMs*(2-aPct/100));const mPct=parseInt(mRange.value);const mPos=(mPct-50)/60;multiBubble.innerText=mPct+'%';multiBubble.style.left=`calc(42px + ${mPos}*(100%-84px))`;multiBubble.style.background=var(--neon-green);multiBubble.style.color="#fff";if(currentMode==='multi') renderMultiCards();saveData();}
function toTotalMs(arr){return(parseInt(arr[0])*60000)+(parseInt(arr[1])*1000)+(parseInt(arr[2])*10);}
function formatMs(totalMs){if(!totalMs||totalMs<=0)return"00:00.00";let ms=Math.floor(totalMs);const m=Math.floor(ms/60000);ms%=60000;const s=Math.floor(ms/1000);ms%=1000;return`${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}.${Math.floor(ms/10).toString().padStart(2,'0')}`;}
init();
</script>
</body>
</html>
